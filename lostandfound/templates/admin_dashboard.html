{% extends "base.html" %}

{% block title %}Admin Dashboard | Nelgak{% endblock %}

{% block content %}
<div class="page admin-page">

  <!-- Header -->
  <div class="admin-header">
    <div>
      <h1>Admin Dashboard</h1>
      <p>Overview of all reported items in the system.</p>
    </div>
    <a href="{% url 'home' %}" class="admin-header-link">View public page</a>
  </div>

  <!-- Stats cards -->
  <div class="admin-stats-grid">
    <div class="admin-stat-card">
      <p class="label">Total reports</p>
      <p class="value">{{ total_reports }}</p>
    </div>

    <div class="admin-stat-card lost">
      <p class="label">Lost</p>
      <p class="value">{{ lost_reports }}</p>
    </div>

    <div class="admin-stat-card found">
      <p class="label">Found</p>
      <p class="value">{{ found_reports }}</p>
    </div>

    <div class="admin-stat-card today">
      <p class="label">New today</p>
      <p class="value">{{ today_reports }}</p>
    </div>
  </div>

  <!-- Filters + search -->
  <div class="admin-filters-wrapper">
    <form method="get" class="admin-filters-form">
      <div class="row">
        <!-- Search -->
        <div class="search">
          <span class="icon">üîç</span>
          <input type="text"
                 name="q"
                 placeholder="Search by item, description, or contact"
                 value="{{ request.GET.q }}">
        </div>

        <!-- Status filter -->
        <select name="status" class="select">
          <option value="all" {% if request.GET.status == 'all' or not request.GET.status %}selected{% endif %}>
            All statuses
          </option>
          <option value="lost" {% if request.GET.status == 'lost' %}selected{% endif %}>Lost</option>
          <option value="found" {% if request.GET.status == 'found' %}selected{% endif %}>Found</option>
          <option value="claimed" {% if request.GET.status == 'claimed' %}selected{% endif %}>Claimed</option>
        </select>

        <!-- Building filter -->
        <select name="building" class="select">
          <option value="all" {% if request.GET.building == 'all' or not request.GET.building %}selected{% endif %}>
            All buildings
          </option>
          <option value="A60" {% if request.GET.building == 'A60' %}selected{% endif %}>CCSIT A60</option>
          <option value="A61" {% if request.GET.building == 'A61' %}selected{% endif %}>CCSIT A61</option>
        </select>

        <!-- Buttons -->
        <button type="submit" class="btn-apply">Apply filters</button>
        <a href="{% url 'admin_dashboard' %}" class="btn-clear">Clear</a>
      </div>
    </form>
  </div>

  <!-- Reports table -->
  <div class="admin-table-card">
    <div class="table-header">
      <h2>Reports</h2>
      <p>{{ reports|length }} result{% if reports|length != 1 %}s{% endif %} shown</p>
    </div>

    {% if reports %}
      <div class="table-scroll">
        <table class="reports-table">
          <thead>
            <tr>
              <th>Item</th>
              <th>Category</th>
              <th>Status</th>
              <th>Location</th>
              <th>Date lost</th>
              <th>Contact</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for item in reports %}
              <tr>
                <td>{{ item.item_name }}</td>
                <td>{{ item.category }}</td>
                <td>
                  <span class="status-badge {{ item.status }}">
                    {{ item.get_status_display }}
                  </span>
                </td>
                <td>{{ item.location_lost }}</td>
                <td>{{ item.date_lost|date:"M d, Y" }}</td>
                <td>{{ item.contact_name }}</td>
                <td>
                  <a href="{% url 'item_detail' item.pk %}" class="btn-small">
                    View
                  </a>
                  <a href="{% url 'edit_item' item.pk %}" class="btn-small2">
                    Edit
                  </a>
                  <form method="POST" action="{% url 'delete_item' item.pk %}" 
                        style="display:inline-block;" 
                        onsubmit="return confirm('Are you sure you want to delete this item? This cannot be undone.');">
                    {% csrf_token %}
                    <button type="submit" class="btn-delete" 
                            >
                      Delete
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="empty-state">No reports found for these filters.</p>
    {% endif %}
  </div>

</div>

<style>
  .admin-page {
    max-width: 1100px;
    margin: 0 auto 2rem auto;
  }

  /* Header */
  .admin-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.4rem;
  }
  .admin-header h1 {
    margin: 0;
    font-size: 1.7rem;
    font-weight: 700;
    background: linear-gradient(to right, #047857, #0d9488);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .admin-header p {
    margin: 3px 0 0;
    font-size: 0.9rem;
    color: #6b7280;
  }
  .admin-header-link {
    font-size: 0.8rem;
    color: #047857;
    text-decoration: none;
    padding: 6px 12px;
    border-radius: 999px;
    background: #ecfdf5;
    border: 1px solid #a7f3d0;
  }

  /* Stats cards */
  .admin-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
    gap: 0.9rem;
    margin-bottom: 1.6rem;
  }
  .admin-stat-card {
    background: white;
    border-radius: 16px;
    padding: 0.85rem 0.95rem;
    box-shadow: 0 8px 24px rgba(15,118,110,0.08);
    border: 1px solid #bbf7d0;
  }
  .admin-stat-card .label {
    margin: 0 0 4px;
    font-size: 0.8rem;
    color: #6b7280;
  }
  .admin-stat-card .value {
    margin: 0;
    font-size: 1.4rem;
    font-weight: 700;
    color: #065f46;
  }
  .admin-stat-card.lost { background: #fef9c3; border-color: #facc15; }
  .admin-stat-card.found { background: #ecfdf5; border-color: #6ee7b7; }
  .admin-stat-card.claimed { background: #eff6ff; border-color: #bfdbfe; }
  .admin-stat-card.today { background: #fdf2f8; border-color: #f9a8d4; }

  /* Filters */
  .admin-filters-wrapper {
    margin-bottom: 1.4rem;
  }
  .admin-filters-form {
    background: linear-gradient(to right, #ecfdf5, #d1fae5);
    border-radius: 18px;
    padding: 10px 14px;
    border: 1px solid #a7f3d0;
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.12);
  }
  .admin-filters-form .row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  .admin-filters-form .search {
    flex: 1 1 260px;
    display: flex;
    align-items: center;
    gap: 6px;
    background: white;
    border-radius: 999px;
    padding: 6px 10px;
    border: 1px solid #a7f3d0;
  }
  .admin-filters-form .search .icon {
    font-size: 0.9rem;
    color: #10b981;
  }
  .admin-filters-form .search input {
    border: none;
    outline: none;
    width: 100%;
    font-size: 0.9rem;
    background: transparent;
  }
  .admin-filters-form .select {
    flex: 0 0 150px;
    padding: 7px 10px;
    border-radius: 999px;
    border: 1px solid #a7f3d0;
    background: #f0fdf4;
    font-size: 0.85rem;
    color: #065f46;
    outline: none;
  }
  .admin-filters-form .select:focus,
  .admin-filters-form .search input:focus {
    box-shadow: 0 0 0 2px #bbf7d0;
    border-color: #10b981;
  }
  .btn-apply {
    padding: 7px 16px;
    border-radius: 999px;
    border: none;
    background: linear-gradient(to right,#10b981,#0d9488);
    color: white;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    white-space: nowrap;
  }
  .btn-clear {
    font-size: 0.8rem;
    color: #047857;
    text-decoration: none;
    white-space: nowrap;
  }

  /* Table */
  .admin-table-card {
    background: white;
    border-radius: 18px;
    padding: 1rem 1.1rem 1.1rem;
    box-shadow: 0 10px 30px rgba(15,118,110,0.08);
    border: 1px solid #bbf7d0;
  }
  .table-header {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 0.7rem;
  }
  .table-header h2 {
    margin: 0;
    font-size: 1.1rem;
    color: #064e3b;
  }
  .table-header p {
    margin: 0;
    font-size: 0.8rem;
    color: #6b7280;
  }

  .table-scroll {
    overflow-x: auto;
  }
  .reports-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.85rem;
  }
  .reports-table thead {
    background: #ecfdf5;
  }
  .reports-table th,
  .reports-table td {
    padding: 8px 10px;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
    white-space: nowrap;
  }
  .reports-table th {
    font-weight: 600;
    color: #065f46;
    font-size: 0.8rem;
  }
  .reports-table tbody tr:hover {
    background: #f9fafb;
  }

  .status-badge {
    padding: 3px 9px;
    border-radius: 999px;
    font-size: 0.75rem;
    font-weight: 600;
  }
  .status-badge.lost {
    background: #fef3c7;
    color: #92400e;
  }
  .status-badge.found {
    background: #dcfce7;
    color: #166534;
  }
  .status-badge.claimed {
    background: #e0f2fe;
    color: #1d4ed8;
  }

  .btn-small {
    padding: 5px 10px;
    border-radius: 999px;
    border: none;
    background: #ecfdf5;
    color: #047857;
    font-size: 0.8rem;
    text-decoration: none;
    font-weight: 500;
  }
  .btn-small2 {
    padding: 5px 10px;
    border-radius: 999px;
    border: none;
    background: #fffbeb; /* Very pale yellow */
    color: #b45309;      /* Deep, readable amber/brown */
    font-size: 0.8rem;
    text-decoration: none;
    font-weight: 500;
    margin-left: 4px;
  }
  .btn-delete {
    padding: 5px 10px;
    border-radius: 999px;
    border: none;
    background: #fef2f2; /* Very pale red/rose */
    color: #b91c1c;      /* Deep red */
    font-size: 0.8rem;
    text-decoration: none;
    font-weight: 500;
    margin-left: 4px;
  }

  .empty-state {
    margin: 0.4rem 0 0;
    font-size: 0.85rem;
    color: #6b7280;
  }

  /* Mobile */
  @media (max-width: 900px) {
    .admin-stats-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
  }
  @media (max-width: 640px) {
    .admin-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.4rem;
    }
    .admin-filters-form {
      border-radius: 16px;
    }
    .admin-filters-form .row {
      align-items: stretch;
    }
    .admin-filters-form .select,
    .btn-apply,
    .btn-clear {
      flex: 1 1 100%;
      text-align: center;
    }
    .btn-clear {
      margin-top: -4px;
    }
  }
</style>
{% endblock %}
